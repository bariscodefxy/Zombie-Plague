#include <amxmodx>
#include <hamsandwich>
#include <colorchat>
#include <zombie_plague_advance>

#define PLUGIN_NAME "[ZP] Assassin Health"
#define PLUGIN_VERS "1.0"
#define PLUGIN_AUTH "hi!"

#define TASK_HEALTH 1234554321

public plugin_init() 
{
	register_plugin(PLUGIN_NAME, PLUGIN_VERS, PLUGIN_AUTH)

	// Fwd's
	RegisterHam(Ham_Spawn, "player", "Fwd_PlayerSpawn_Post", 1)
	RegisterHam(Ham_Killed, "player", "Fwd_PlayerKilled_Pre", 0)
}

public Fwd_PlayerSpawn_Post(id)
{
	if (task_exists(id+TASK_HEALTH))
		remove_task(id+TASK_HEALTH)
}

public Fwd_PlayerKilled_Pre(victim, attacker, shouldgib)
{
	if (task_exists(victim+TASK_HEALTH))
		remove_task(victim+TASK_HEALTH)
}

public zp_round_started(mode, id)
{
	if (mode != MODE_ASSASSIN)
		return
		
	if (!zp_get_user_assassin(id))
		return
		
	if (mode != MODE_SURVIVOR)
		return
		
	if (!zp_get_user_survivor(id))
		return
		
	if (mode != MODE_NEMESIS)
		return
		
	if (!zp_get_user_nemesis(id))
		return
		
	if (mode != MODE_SNIPER)
		return
		
	if (!zp_get_user_sniper(id))
		return
		
	set_task(34.0, "Task_ShowHealth", id+TASK_HEALTH, _, _, "b")

}

public Task_ShowHealth(id)
{
	id -= TASK_HEALTH
	
	if (!zp_get_user_assassin(id))
		remove_task(id+TASK_HEALTH)
		
	static HealthString[16];
	AddCommas(get_user_health(id), HealthString, 15);
	
	ColorChat(0, GREY, "^x04[ZP]^x01 A ^x03Rapture^x01 Reminder ^x03@^x01 ^x04Assassin^x01 still has ^3%d ^x04health points!^x01", HealthString)
	
	if (!zp_get_user_survivor(id))
		remove_task(id+TASK_HEALTH)
	
	ColorChat(0, GREY, "^x04[ZP]^x01 A ^x03Rapture^x01 Reminder ^x03@^x01 ^x04Survivor^x01 still has ^3%d ^x04health points!^x01", HealthString)

	if (!zp_get_user_nemesis(id))
		remove_task(id+TASK_HEALTH)
	
	ColorChat(0, GREY, "^x04[ZP]^x01 A ^x03Rapture^x01 Reminder ^x03@^x01 ^x04Nemesis^x01 still has ^3%d ^x04health points!^x01", HealthString)

	if (!zp_get_user_sniper(id))
		remove_task(id+TASK_HEALTH)
	
	ColorChat(0, GREY, "^x04[ZP]^x01 A ^x03Rapture^x01 Reminder ^x03@^x01 ^x04Sniper^x01 still has ^3%d ^x04health points!^x01", HealthString)

}

// BAKiR
//
public AddCommas( iNum , szOutput[] , iLen )
{
    new szTmp[ 15 ] , iOutputPos , iNumPos , iNumLen;
    
    if ( iNum < 0 )
    {
        szOutput[ iOutputPos++ ] = '-';
        iNum = abs( iNum );
    }
    
    iNumLen = num_to_str( iNum , szTmp , charsmax( szTmp ) );

    if ( iNumLen <= 3 )
    {
        iOutputPos += copy( szOutput[ iOutputPos ] , iLen , szTmp );
    }
    else
    {
        while ( ( iNumPos < iNumLen ) && ( iOutputPos < iLen ) ) 
        {
            szOutput[ iOutputPos++ ] = szTmp[ iNumPos++ ];
        
            if( ( iNumLen - iNumPos ) && !( ( iNumLen - iNumPos ) % 3 ) ) 
                szOutput[ iOutputPos++ ] = ',';
        }
        
        szOutput[ iOutputPos ] = EOS;
    }
    
    return iOutputPos;
}  
/* AMXX-Studio Notes - DO NOT MODIFY BELOW HERE
*{\\ rtf1\\ fbidis\\ ansi\\ ansicpg1252\\ deff0{\\ fonttbl{\\ f0\\ fnil\\ fcharset0 Tahoma;}}\n\\ viewkind4\\ uc1\\ pard\\ ltrpar\\ lang1053\\ f0\\ fs16 \n\\ par }
*/
