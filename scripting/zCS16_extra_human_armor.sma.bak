#include <amxmodx>
#include <fakemeta>
#include <zombie_plague_advance>

new const g_item1_name[] = { "Armura (100ap)" }
new const g_item2_name[] = { "Armura (200ap)" }
const g_item1_cost = 5
const g_item2_cost = 10

new const g_sound_buyarmor[] = { "items/tr_kevlar.wav" }
const g_armor1_amount = 100
const g_armor2_amount = 200
const g_armor_limit = 999

// Item IDs
new g_itemid1_humanarmor
new g_itemid2_humanarmor

public plugin_precache()
{
	precache_sound(g_sound_buyarmor)
}

public plugin_init()
{
	register_plugin("[CS16] Extra: Armura", "1.0", "CS16 Team")
	
	g_itemid1_humanarmor = zp_register_extra_item(g_item1_name, g_item1_cost, ZP_TEAM_HUMAN)
	g_itemid2_humanarmor = zp_register_extra_item(g_item2_name, g_item2_cost, ZP_TEAM_HUMAN)
}

stock chat_color(const id, const input[], any:...)
{
	new count = 1, players[32]
	static msg[191]
	vformat(msg, 190, input, 3)
  
	replace_all(msg, 190, "^x04", "^4")
	replace_all(msg, 190, "^x01", "^1")
	replace_all(msg, 190, "^x03", "^3")
  
	if (id) players[0] = id; else get_players(players, count, "ch")
	{
		for (new i = 0; i < count; i++)
		{
			if (is_user_connected(players[i]))
			{
				message_begin(MSG_ONE_UNRELIABLE, get_user_msgid("SayText"), _, players[i])
				write_byte(players[i]);
				write_string(msg);
				message_end();
			}
		}
	}
}

// Human buys our upgrade, give him some armor
public zp_extra_item_selected(player, itemid)
{
	if (itemid == g_itemid1_humanarmor)
	{
		new name[32]
		get_user_name(player, name, 31)
		set_hudmessage(random_num(0, 255), random_num(0, 255), random_num(0, 255), -1.0, 0.55,0, 6.0, 5.25, 0.1, 0.2,-1)
		show_hudmessage(player, "%s, you have been equiped with armor (100ap)", name)
		chat_color(player, "^x04[ZP]^x01 ^x03%s^x01, you bought^x04 Armor (100ap)^x01", name)

		set_pev(player, pev_armorvalue, float(min(pev(player, pev_armorvalue)+g_armor1_amount, g_armor_limit)))
		engfunc(EngFunc_EmitSound, player, CHAN_BODY, g_sound_buyarmor, 1.0, ATTN_NORM, 0, PITCH_NORM)
	}
	
	if (itemid == g_itemid2_humanarmor)
	{
		new name[32]
		get_user_name(player, name, 31)
		set_hudmessage(0, 0, 255, -1.0, 0.7, 1, 0.0, 5.0, 1.0, 1.0, -1)
		show_hudmessage(player, "%s, you have been equiped with armor (200ap)", name)
		chat_color(player, "^x04[ZP]^x01 ^x03%s^x01, you bought^x04 Armor (200ap)^x01", name)

		set_pev(player, pev_armorvalue, float(min(pev(player, pev_armorvalue)+g_armor2_amount, g_armor_limit)))
		engfunc(EngFunc_EmitSound, player, CHAN_BODY, g_sound_buyarmor, 1.0, ATTN_NORM, 0, PITCH_NORM)
	}
}
/* AMXX-Studio Notes - DO NOT MODIFY BELOW HERE
*{\\ rtf1\\ fbidis\\ ansi\\ ansicpg1252\\ deff0{\\ fonttbl{\\ f0\\ fnil\\ fcharset0 Tahoma;}}\n\\ viewkind4\\ uc1\\ pard\\ ltrpar\\ lang1053\\ f0\\ fs16 \n\\ par }
*/
